#!/bin/sh

git clone https://github.com/dreadlocked/Drupalgeddon2.git

wget https://ftp.drupal.org/files/projects/drupal-8.5.0.zip
unzip drupal-8.5.0.zip
mv drupal-8.5.0 drupal

cp -R drupal /var/www/html

chmod a+w /var/www/html/drupal/sites/default/

echo "[+] Enter the mysql password of root"

mysql -u root -p -e "CREATE DATABASE drupal CHARACTER SET utf8 COLLATE utf8_general_ci";

cat << EOS > ./dbscript.txt
CREATE USER drupal@localhost IDENTIFIED BY 'password';

GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, CREATE TEMPORARY TABLES ON drupal.* TO 'drupal'@'localhost' IDENTIFIED BY 'password';

exit
EOS


echo "[+] Enter the mysql password of root"

mysql -u root -p < ./dbscript.txt


cp /var/www/html/drupal/sites/default/default.settings.php /var/www/html/drupal/sites/default/settings.php

chmod a+w /var/www/html/drupal/sites/default/settings.php

# enable safe url

a2enmod rewrite

cat << EOS >> /etc/apache2/sites-available/000-default.conf
<Directory /var/www/html>
 Allowoverride All
</Directory>
EOS

service apache2 restart

echo "[+] OK! Drupal installation is complete! You must see http://localhost/drupal/core/install.php, after that, you can check version of drupal at http://localhost/drupal/?q=admin/reports/status with admin permission"

echo "[+] After installation, you type 'python3 44448.py',and you can create admin user"
